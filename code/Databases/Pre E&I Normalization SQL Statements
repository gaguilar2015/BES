//  The following statement creates a DATA_PART_A table in the Pre E&I database using the one in the Processing database
//  by extracting only the survey variables and discarding the ones generated by Survey Solutions
//  and also assigning more descriptive names to the variables

create table DATA_PART_A
select Buss_Num as bus_num, GPS__Latitude as gps_lat, GPS__Longitude as gps_long, GPS__Accuracy as gps_accuracy, GPS__Altitude as gps_alt, GPS__Timestamp as gps_timestamp, Num_Visits as num_visits, Nombre as sample_name, Direcion as sample_address, Ed_Num as ed_num, ClusterNum as cluster, BusNam as name, BusNam_Legal as legal_name, Street as street, District as district, CTV as ctv, BusTin as bus_tin, BusOpe1_1 as bus_operational, BS12 as bus_operational_2, BusOpe1_2 as bus_operational_3, BusOpe1_2_1 as bus_operational_4, BusOpe1_2_2 as bus_operational_5, BusOpe1_3 as bus_operational_6, BusOpe1_3_9 as bus_operational_7, BusOpe1_4 as bus_operational_8, BusOpe1_5 as bus_operational_9, BusBir as bus_dob, BusDays as bus_weeks_open, BusStat as bus_status, BusStat_1 as bus_status_1, BusLoc1 as bus_location_1, BusLoc2 as bus_location_2, BusMan1 as bus_main_1, BusMan2 as bus_main_2, BusMan4 as bus_main_3, BusMan3 as bus_main_4, BusBranch as bus_branch, BusLoc3 as bus_location_3, BranchNumber as num_branches, BusPrim as bus_primary, BusPrimCode as primary_isic, BusPrim_1 as bus_primary_1, Bus_Isic_Desc as isic_desc, BusPrim_1A as broad_isic, BusPrim_2 as econ_activity, BusPrim_3 as activity_percentage, Otheisic as other_isic, BusPrim_4 as other_isic_broad, BusPrim_4b as other_bus_isic, BusPrim_5 as employed, BusPrim_5_1 as other_data, BusPrim_Rev as revenue, BusRev1_1 as financial_date, BusRev1_2 as financial_date_end, Contact_Name as contact_name, Contact_Phone as contact_phone, Contact_Address as contact_address, Contact_Email as contact_email, BustS1_R as listed_financials, BustS3, BustS2, Pickup_Date, BustS4
from BES_Processing_Database.DATA_PART_A;



//  The following statement creates the BRANCH_ROSTER table in the Pre E&I database using the one in the Processing database
//  but replacing the ParentId1 variable generated by Survey Solutions with the Business Number as the unique identifier 
//  and assigning more descriptive names to the other variables

create table BRANCH_ROSTER
select d.Buss_Num as bus_num, b.Id as id, b.BusLoc4 as location, b.BusOth2 as name, b.BusOth2_1 as description, b.BusOthemplo as employees
from BES_Processing_Database.DATA_PART_A d inner join BES_Processing_Database.BRANCH_ROSTER b on d.Id = b.ParentId1;



//  The following statement creates the VISITS_ROSTER table in the Pre E&I database using the one in the Processing database
//  but replacing the ParentId1 variable generated by Survey Solutions with the Business Number as the unique identifier 
//  and assigning more descriptive names to the other variables

create table VISITS_ROSTER
select d.Buss_Num as bus_num, v.Id as id, v.dateofvisit as visit_date, v.HOUR_STARTED as started, v.HOUR_ENDED as ended, v.Result_Code1 as result_code, v.Language_Code as language
from BES_Processing_Database.DATA_PART_A d inner join BES_Processing_Database.VISITS_ROSTER v on d.Id = v.ParentId1;



//  The following statement creates the DATA_PART_B table in the Pre E&I database using the one in the Processing database
//  by extracting only the variables that pertain to the generic modules of the Part B questionnaire and renaming the
//  variable QID as bus_num

create table DATA_PART_B
select QID as bus_num, HI1, HI3, HI5, HI6, HI8, HI12, BR1, BR2, BR3, BR6, BR4, BR5, BR7, BR8, BE1, BE2, BE3, BE4, BE5, BE6, BE7, BE8, BE9, BE10, BE11, BE12, BE13, BE14, BE15, BE16, SCT1, SCT2, SCT3, SCT4, ICE11A, ICE11B, ICE12A, ICE12B, ICE13A, ICE13B, ICE14A, ICE14B, ICE15A, ICE15B, CE21, CE22, CE23, CE24, CE25, CE26, CE31, CE32, CE33, CE34, CE35, CE36, CE41, CE42, CE43, CE44, CE45, CE46, CE51, CE52, CE53, CE54, CE55, CE56, IND
from BES_Processing_Database.DATA_PART_B;



//  The following statement creates the WHOLESALE_RETAIL table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Wholesale/Retail industry modules of Part B and only the
//  records that belong to this industry based on the Ind variable

create table WHOLESALE_RETAIL
select QID as Bus_Num, GPRW1A, GPRW1B, GPRW2A, GPRW2B, GPRW3A, GPRW3B, GPRW4A, GPRW4B, GPRW5A, GPRW5B, GPRW6A, GPRW6B, GPRW7A, GPRW7B, GPRW8A, GPRW8B, GPRW9A, GPRW9B, GPRW10A, GPRW10B, GPRW11A, GPRW11B, GPRW12A, GPRW12B, GPRW13A, GPRW13B, GPRW14A, GPRW14B, GPRW15A, GPRW15B, GPR16A, GPR16B
from BES_Processing_Database.DATA_PART_B
where ind = 1;


//  The following statement creates the AGRICULTURE_FISHERIES table in the Pre E&I database using the DATA_PART_B table of the
//  Processing database by extracting only the variables that pertain to the Agriculture/Fisheries industry modules of Part B
//  and only the records that belong to this industry based on the Ind variable

create table AGRICULTURE_FISHERIES
select QID as Bus_Num, SPA001A, SPA012A, SPA013A, SPA01AA, SPA018A, SPA0211A, SPA25A, SPA02AA, SPA03AA, SPA041A, SPA05A, SPA05B, SPA05C, SPA05D, SPA06, EPA34A, EPA01AA, EPA03AA, EPA2AA, EPA17A, EPA18A, EPA18B, EPA18C, EPA18D, EPA25
from BES_Processing_Database.DATA_PART_B
where ind = 2;


//  The following statement creates the MINING table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Mining industry modules of Part B and only the records 
//  that belong to this industry based on the Ind variable

create table MINING
select QID as Bus_Num, SPM15A, SPM13, SPM16A, SPM17A, SPM18A, EPM4AA, EPM34A, EPM18A, EPM37A, EPM88A, EPM88B, EPM88C, EPM88D, EPM89
from BES_Processing_Database.DATA_PART_B
where ind = 3;



//  The following statement creates the CONSTRUCTION table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Construction industry modules of Part B and only the records 
//  that belong to this industry based on the Ind variable

create table CONSTRUCTION
select QID as Bus_Num, SPC1, SPC2, SPC3, SPC4, SPC5, SPC6, SPC6A, SPC6B, SPC6C, SPC6D, SPC6E, SPC7, SPC8, EPC1, EPC2, EPC3, EPC4, EPC5, EPC6, EPC7, EPC8A, EPC8B, EPC8C, EPC8D, EPC9, EPC41, EPC41A, EPC41B, EPC41C, EPC41D
from BES_Processing_Database.DATA_PART_B
where ind = 4;



//  The following statement creates the TRANSPORT_COMMUNICATION table in the Pre E&I database using the DATA_PART_B table of the 
//  Processing database by extracting only the variables that pertain to the Transport/Communication industry modules of Part B and 
//  only the records that belong to this industry based on the Ind variable

create table TRANSPORT_COMMUNICATION
select QID as Bus_Num, SST12, SST12A, SST12B, SST12C, SST12D, SST12E, SST12F, SST11, SST21, SST21A, SST21B, SST21C, SST21D, SST22, SST22A, SST22B, SST22C, SST23, SST31, SST41, EPT18, EPT18A, EPT18B, EPT18C, EPT18D
from BES_Processing_Database.DATA_PART_B
where ind = 5;



//  The following statement creates the TOURISM table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Tourism industry modules of Part B and only the records 
//  that belong to this industry based on the Ind variable

create table TOURISM
select QID as Bus_Num, SSAC11, SSAC12, SSAC13, SSAC13A, SSAC13B, SSAC13C, SSAC13D, SSAC14, SSAC15, SSAC16, SSAC17, SSAC18, SSAC19, SSAC20
from BES_Processing_Database.DATA_PART_B
where ind = 6;



//  The following statement creates the MANUFACTURE_FOOD table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Manufacture (Food) industry modules of Part B and only the records 
//  that belong to this industry based on the Ind variable

create table MANUFACTURE_FOOD
select QID as Bus_Num, SPM1, SPM2, SPM3, SPM4, SPM5, SPM6, SPM7, SPM8, SPM9, SPM10, SPM11, SPM12, SPM13A, SPM13B, SPM13C, SPM13D, SPM14, EPM1, EPM2, EPM3, EPM4, EPM5, EPM6, EPM7, EPM8, EPM9, EPM10, EPM11, EPM12, EPM13, EPM14, EPM15, EPM16, EPM17, EPM18, EPM19A, EPM19B, EPM19C, EPM26
from BES_Processing_Database.DATA_PART_B
where ind = 7;



//  The following statement creates the MANUFACTURE_OTHER table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Manufacture (Other) industry modules of Part B and only the records 
//  that belong to this industry based on the Ind variable

create table MANUFACTURE_OTHER
select QID as Bus_Num, SPM15, SPM16, SPM17, SPM18, SPM19, SPM20, SPM21, SPM22, SPM23, SPM24, SPM25, SPM26, SPM27A, SPM27B, SPM27C, SPM27D, SPM28, EPM27, EPM28, EPM29, EPM30, EPM31, EPM32, EPM33, EPM34, EPM35, EPM36, EPM37, EPM38, EPM39, EPM40, EPM41, EPM42, EPM43, EPM44, EPM45, EPM46, EPM47A, EPM47B, EPM47C, EPM47D, EPM48
from BES_Processing_Database.DATA_PART_B
where ind = 8;



//  The following statement creates the REAL_ESTATE table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the Real Estate industry modules of Part B and only the records 
//  that belong to this industry based on the Ind variable

create table REAL_ESTATE
select QID as Bus_Num, SPR1, SPR2, SPR3, SPR4, SPR4A, SPR4B, SPR4C, SPR4D, SPR4E, SPR5A, SPR5B, SPR5C, SPR5D, SPR6
from BES_Processing_Database.DATA_PART_B
where ind = 9;



//  The following statement creates the GENERAL table in the Pre E&I database using the DATA_PART_B table of the Processing
//  database by extracting only the variables that pertain to the General industry modules of Part B and only the records 
//  that responded to this based on the Ind variable

create table GENERAL
select QID as Bus_Num, SPG11, SPG12, SPG13, SPG21, SPG22, SPG23, SPG24, SPG25, SPG26, SPG31, SPG32, SPG33, SPG34, SPG35, SPG36A, SPG36B, SPG36C, SPG36D, SPG37, EPG11, EPG12, EPG13, EPG21, EPG22, EPG23, EPG24, EPG25, EPG26, EPG27, EPG28, EPG29, EPG210, EPG211A, EPG211B, EPG211C, EPG211D, EPG212
from BES_Processing_Database.DATA_PART_B
where ind = 10;
